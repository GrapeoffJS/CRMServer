{"version":3,"sources":["components/home-page/sales-funnel/helpers/loader.jsx","components/home-page/sales-funnel/helpers/tooltip-functions.js","components/home-page/sales-funnel/ClosestTask.jsx","components/home-page/sales-funnel/sales-funnel-students.jsx","components/home-page/sales-funnel/sales-funnel.jsx"],"names":["LoaderTag","styled","div","props","precentage","Loader","className","tooltipNeedsCheckerOfSingleString","length","string","dop","maxLength","width","dopTooltipText","placement","title","tooltipCheckerOfTrioString","stud","surname","name","midname","ClosestTask","closestTask","moment","deadline","format","responsible","text","SalesFunnelStudents","Url","card","pupils","pupilsList","pageSize","useState","loaded","filter","salesFunnelStep","_id","map","index","draggableId","provided","background","draggableProps","dragHandleProps","ref","innerRef","to","parentPhone","minPaidSubscription","portable","contains","statuses","stat","color","overlay","SalesFunnel","UrlProd","setLoaded","salesFunnelList","setSalesFunnelList","setPupilsList","useEffect","a","axiosGetFunnelSteps","salesFunnelSteps","prev","step","flat","salesFunnelFromServer","onDragEndHandler","result","destination","array1","source","droppableId","array2","splice","deletingElement","Array","from","Set","oldStatuses","el","axiosUpdateStudent","jstctn","onDragEnd","style","display","order","status","funnel","minPaidSubscriptionsAmount","provide","droppableProps","placeholder"],"mappings":"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","file":"static/js/3.91ddec0b.chunk.js","sourcesContent":["import React from \"react\"\nimport styled from \"@emotion/styled\"\n\nconst LoaderTag = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: ${props => props.precentage ? \"100%\" : \"100vh\"};\n  .lds-ring {\n    display: inline-block;\n    position: relative;\n    width: 80px;\n    height: 80px;\n  }\n  .lds-ring div {\n    box-sizing: border-box;\n    display: block;\n    position: absolute;\n    width: 64px;\n    height: 64px;\n    margin: 8px;\n    border: 8px solid #001529;\n    border-radius: 50%;\n    animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n    border-color: #001529 transparent transparent transparent;\n  }\n  .lds-ring div:nth-of-type(1) {\n    animation-delay: -0.45s;\n  }\n  .lds-ring div:nth-of-type(2) {\n    animation-delay: -0.3s;\n  }\n  .lds-ring div:nth-of-type(3) {\n    animation-delay: -0.15s;\n  }\n  @keyframes lds-ring {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n`\n\nexport const Loader = ({ precentage }) => {\n  return (\n    <LoaderTag precentage={precentage}>\n      <div className=\"lds-ring\">\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n      </div>\n    </LoaderTag>\n  );\n};","// imports from plugins\nimport {Tooltip} from \"antd\"\nimport React from \"react\"\n\n// imports from files of project\nimport {FunnelStepText} from \"./sales-funnel-styled\"\n\nexport const tooltipNeedsCheckerOfSingleString = (length, string, dop = '', maxLength = 24, width = \"\", dopTooltipText = \"\") => {\n  if (length + dop.length > maxLength) {\n    return (\n      <Tooltip placement=\"leftTop\" title={`${dopTooltipText}${dopTooltipText !== \"\" ? \" \" : \"\"}${string}`}>\n        <FunnelStepText width={width}>{dop} {string}</FunnelStepText>\n      </Tooltip>\n    )\n  }\n  return <FunnelStepText>{dop} {string}</FunnelStepText>\n}\n\nexport const tooltipCheckerOfTrioString = (length, stud, dop = '', maxLength = 24, width = \"\", dopTooltipText = \"\") => {\n  if (length + dop.length > maxLength) {\n    return (\n      <Tooltip placement=\"leftTop\" title={`${dopTooltipText}${dopTooltipText !== \"\" ? \" \" : \"\"}${stud.surname} ${stud.name} ${stud.midname}`}>\n        <FunnelStepText width={width}>{stud.surname} {stud.name} {stud.midname}</FunnelStepText>\n      </Tooltip>\n    )\n  }\n  return <FunnelStepText>{stud.surname} {stud.name} {stud.midname}</FunnelStepText>\n}","import moment from \"moment\"\nimport React from \"react\"\n\nimport {DropdownClosestTask} from \"./helpers/sales-funnel-styled\"\n\nexport const ClosestTask = ({closestTask}) => {\n  return (\n    <DropdownClosestTask>\n      <p className=\"name\">{closestTask?.name}</p>\n      <p>До: {moment(closestTask?.deadline).format(\"DD/MM/YYYY | HH:mm\")}</p>\n      <p>Ответственнен: {closestTask?.responsible[0]?.surname} {closestTask?.responsible[0]?.name} {closestTask?.responsible[0]?.midname}</p>\n      <div>\n        {closestTask?.text}\n      </div>\n    </DropdownClosestTask>\n  )\n}","// imports from plugins\nimport React, {useState} from \"react\"\nimport {Draggable} from \"react-beautiful-dnd\"\nimport {NavLink} from \"react-router-dom\"\nimport {Tag, Button, Dropdown} from \"antd\"\nimport moment from \"moment\"\n\n// imports from files of project\nimport {\n  DropdownClosestTask,\n  FunnelStepStudent,\n  HoverTask,\n  StatusesBlock,\n  VisibilitySpan\n} from \"./helpers/sales-funnel-styled\"\nimport {Loader} from \"./helpers/loader\"\nimport {tooltipCheckerOfTrioString} from \"./helpers/tooltip-functions\"\nimport {ClosestTask} from \"./ClosestTask\"\n\nexport const SalesFunnelStudents = ({Url, card, pupils, pageSize}) => {\n\n  // data\n  const {pupilsList} = pupils\n  // data\n\n  // useState\n  const [loaded] = useState(false)\n  // useState\n\n  // methods\n  const lengthCalculate = (statuses) => {\n    if (Array.isArray(statuses)) return statuses.length\n    return 0\n  }\n  // methods\n\n  return (\n    <>\n      {loaded ? <Loader\n        precentage={true}/> : pupilsList.filter(stud => stud.salesFunnelStep === card._id).map((stud, index) => (\n        <Draggable key={stud._id} draggableId={`${stud._id}`} index={index}>\n          {provided => (\n            <FunnelStepStudent background={card.background} {...provided.draggableProps}\n                               {...provided.dragHandleProps} ref={provided.innerRef}>\n              <div className=\"funnelStepStudent__first--info\">\n                <div>\n                  <NavLink to={`/student/${stud._id}`}>\n                    {tooltipCheckerOfTrioString(`${stud.surname} ${stud.name} ${stud.midname}`.length, stud, \"\", 25, \"230px\", \"ФИО:\")}\n                  </NavLink>\n                </div>\n                <div>\n                  <VisibilitySpan>Тел.Родителя:</VisibilitySpan> {stud.parentPhone}\n                </div>\n                <div>\n                  <VisibilitySpan>Мин.Абонемент:</VisibilitySpan> {stud.minPaidSubscription || 0}₽\n                </div>\n                <StatusesBlock portable={true} contains={stud.statuses.length}>\n                  {stud.statuses.map(stat => (\n                    <Tag key={stat._id} color={stat.color}>{stat.name}</Tag>\n                  ))}\n                </StatusesBlock>\n                {stud.closestTask.length ? <Dropdown overlay={<ClosestTask closestTask={stud.closestTask[0]}/>}>\n                  <HoverTask>\n                    Ближайшая задача\n                  </HoverTask>\n                </Dropdown> : \"\"}\n              </div>\n            </FunnelStepStudent>\n          )}\n        </Draggable>\n      ))}\n    </>\n\n  )\n}","// imports from plugins\nimport React, {useEffect, useState} from \"react\"\nimport {DragDropContext, Droppable} from \"react-beautiful-dnd\"\n\n// imports from files of project\nimport {\n  FunnelSection,\n  FunnelStep,\n  FunnelStepAbonementSum,\n  FunnelStepHeader,\n  Wrapper\n} from \"./helpers/sales-funnel-styled\"\nimport {SalesFunnelModal} from \"./sales-funnel-modal\"\nimport {Loader} from \"./helpers/loader\"\nimport {tooltipNeedsCheckerOfSingleString} from \"./helpers/tooltip-functions\"\nimport UrlProd from \"../../../url/url\"\nimport {SalesFunnelStudents} from \"./sales-funnel-students\"\nimport {axiosGetFunnelSteps, axiosUpdateStudent} from \"./helpers/axios-requests\"\n\nconst SalesFunnel = () => {\n\n  // data\n  const status = 1\n  const Url = status ? UrlProd : \"https://dvmncrm.herokuapp.com\"\n  // data\n\n  // useState\n  const [loaded, setLoaded] = useState(true)\n  const [salesFunnelList, setSalesFunnelList] = useState([])\n  const [pupilsList, setPupilsList] = useState([])\n  // useState\n\n  // useEffect\n  useEffect(() => {\n    const salesFunnelFromServer = async () => {\n      const salesFunnelSteps = await axiosGetFunnelSteps(Url)\n      setSalesFunnelList(prev => prev = salesFunnelSteps)\n      setPupilsList(prev => prev = salesFunnelSteps.map(step => step.pupils).flat(2))\n      setLoaded(prev => prev = false)\n    }\n    salesFunnelFromServer()\n    return () => {\n      setSalesFunnelList(prev => prev = [])\n      setPupilsList(prev => prev = [])\n    }\n  }, [Url])\n  // useEffect\n\n  // Methods\n  const onDragEndHandler = async (result) => {\n    if (!result.destination) {\n      return setPupilsList(prev => prev)\n    }\n\n    const array1 = pupilsList.filter((stud) => stud.salesFunnelStep === result.source.droppableId)\n    const array2 = pupilsList.filter((stud) => stud.salesFunnelStep === result.destination.droppableId)\n    const [deletingElement] = array1.splice(result.source.index, 1)\n\n    if (result.source.droppableId === result.destination.droppableId) {\n      array1.splice(result.destination.index, 0, deletingElement)\n\n      return setPupilsList(prev => Array.from(new Set([...prev, ...array1, ...array2])))\n    }\n\n    const oldStatuses = deletingElement.statuses\n    deletingElement.statuses = deletingElement.statuses.map(el => el = el._id)\n    deletingElement.salesFunnelStep = result.destination.droppableId\n\n    await axiosUpdateStudent(Url, deletingElement._id, deletingElement)\n    deletingElement.statuses = oldStatuses\n\n    array2.splice(result.destination.index, 0, deletingElement)\n\n    return setPupilsList(prev => Array.from(new Set([...prev, ...array1, ...array2])))\n  }\n  // Methods\n\n  return (\n    <Wrapper>\n      {loaded ? <Loader/> : <FunnelSection jstctn={salesFunnelList.length < 6 ? true : false}>\n        <DragDropContext onDragEnd={onDragEndHandler}>\n          {salesFunnelList.map(card =>\n            <FunnelStep key={card._id} style={card.name === \"Занимаются\" || card.name === \"Занимается\" ? {display: \"none\"} : {display: \"block\"}} className={\"card\"}>\n              <FunnelStepHeader background={card.background}>\n                {tooltipNeedsCheckerOfSingleString(card.name.length, card.name, \"\", 30, \"220px\")}\n                {card.order === 1 ? <SalesFunnelModal setLoaded={setLoaded} status={status}\n                                                      funnel={salesFunnelList} Url={Url}\n                                                      setPupilsList={setPupilsList}/> : \"\"}\n              </FunnelStepHeader>\n              <FunnelStepAbonementSum background={card.background}>\n                {card.minPaidSubscriptionsAmount || 0}руб.\n              </FunnelStepAbonementSum>\n              <Droppable droppableId={`${card._id}`}>\n                {provide => (\n                  <div className=\"droppable-container\" {...provide.droppableProps}\n                       ref={provide.innerRef}>\n                    <SalesFunnelStudents card={card} pupils={{pupilsList, setPupilsList}} Url={Url}/>\n                    {provide.placeholder}\n                  </div>\n                )}\n              </Droppable>\n            </FunnelStep>\n          )}\n        </DragDropContext>\n      </FunnelSection>}\n    </Wrapper>\n  )\n}\n\nexport default SalesFunnel"],"sourceRoot":""}