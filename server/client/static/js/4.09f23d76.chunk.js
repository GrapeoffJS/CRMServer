(this["webpackJsonpcrm-shool-app"]=this["webpackJsonpcrm-shool-app"]||[]).push([[4],{672:function(e,t,n){"use strict";n.r(t);var c,r=n(2),a=n(9),s=n(18),i=n.n(s),o=n(33),l=n(4),j=n(0),u=n.n(j),d=n(670),b=n(280),O=n(649),p=n(62),h=n(651),f=n(279),x=n(21),m=n.n(x),v=n(176),g=n.n(v),k=n(673),S=n(173),y=n(23),w=n(74),_=n(199),C=n(129),N=n(1),F=u.a.memo((function(e){var t=e.funnel,n=e.Url,c=e.setPupilsList,s=e.status,u=e.setLoaded,d=e.bigIcon,x=void 0!==d&&d,v=e.update,F=void 0===v?function(){}:v,I=e.defaultValueOptionFunnel,E=void 0===I?"":I,P=new RegExp(/\w+#[0-9]{4}/),D="DD-MM-YYYY",T=Object(j.useState)(!1),Y=Object(l.a)(T,2),L=Y[0],q=Y[1],z=Object(j.useState)(!1),M=Object(l.a)(z,2),R=M[0],U=M[1],V=Object(j.useState)(m()("01-01-2021",D)),A=Object(l.a)(V,2),H=A[0],K=A[1],J=Object(j.useState)(""),B=Object(l.a)(J,2),X=B[0],G=B[1],Q=Object(j.useState)(""),W=Object(l.a)(Q,2),Z=W[0],$=W[1],ee=Object(j.useState)(""),te=Object(l.a)(ee,2),ne=te[0],ce=te[1],re=Object(j.useState)(""),ae=Object(l.a)(re,2),se=ae[0],ie=ae[1],oe=Object(j.useState)(""),le=Object(l.a)(oe,2),je=le[0],ue=le[1],de=Object(j.useState)(""),be=Object(l.a)(de,2),Oe=be[0],pe=be[1],he=Object(j.useState)(""),fe=Object(l.a)(he,2),xe=fe[0],me=fe[1],ve=Object(j.useState)(""),ge=Object(l.a)(ve,2),ke=ge[0],Se=ge[1],ye=Object(j.useState)(t[0]._id),we=Object(l.a)(ye,2),_e=we[0],Ce=we[1],Ne=Object(j.useState)(["+9 (999) 999-99-99"]),Fe=Object(l.a)(Ne,2),Ie=Fe[0],Ee=Fe[1],Pe=Object(j.useState)(["+9 (999) 999-99-99"]),De=Object(l.a)(Pe,2),Te=De[0],Ye=De[1],Le=function(e){return e.target.value=""},qe=function(e){return function(t){"Enter"===t.key&&e((function(e){return[].concat(Object(a.a)(e),[", ",e[0]])}))}},ze=function(){G((function(e){return""})),$((function(e){return""})),ce((function(e){return""})),K((function(e){return m()("01-01-2021",D)})),ie((function(e){return""})),pe((function(e){return""})),Se((function(e){return""})),Ee((function(e){return["+9 (999) 999-99-99"]})),Ye((function(e){return["+9 (999) 999-99-99"]}))},Me=function(){U(!1),ze()},Re=function(){U(!0)},Ue=function(){var e=Object(o.a)(i.a.mark((function e(){var t,o,l,j,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,q(!0),""!==se){e.next=5;break}throw Object(y.e)("\u041e\u0448\u0438\u0431\u043a\u0430!","\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u043f\u043e\u043b"),new Error("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u043f\u043e\u043b");case 5:if(3===Oe.split(" ").filter((function(e){return""!==e})).length){e.next=8;break}throw Object(y.e)("\u041e\u0448\u0438\u0431\u043a\u0430!","\u0424\u0418\u041e \u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u044b \u043d\u0435\u0432\u0435\u0440\u043d\u043e"),new Error("\u0424\u0418\u041e \u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044f \u0432\u0432\u0435\u0434\u0435\u043d\u044b \u043d\u0435\u0432\u0435\u0440\u043d\u043e");case 8:if(""===ke||-1!==ke.search(P)){e.next=11;break}throw Object(y.e)("\u041e\u0448\u0438\u0431\u043a\u0430!","\u041d\u0438\u043a \u0432 \u0434\u0438\u0441\u043a\u043e\u0440\u0434\u0435 \u0431\u044b\u043b \u0432\u0432\u0435\u0434\u0451\u043d \u043d\u0435 \u0432\u0435\u0440\u043d\u043e, \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 '#' \u0438 \u0446\u0438\u0444\u0440 \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0451, \u0430 \u0442\u0430\u043a \u0436\u0435 \u0440\u0443\u0441\u0441\u043a\u0438\u0445 \u0431\u0443\u043a\u0432"),new Error("\u041d\u0438\u043a \u0432 \u0434\u0438\u0441\u043a\u043e\u0440\u0434\u0435 \u0431\u044b\u043b \u0432\u0432\u0435\u0434\u0451\u043d \u043d\u0435 \u0432\u0435\u0440\u043d\u043e, \u043f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 '#' \u0438 \u0446\u0438\u0444\u0440 \u043f\u043e\u0441\u043b\u0435 \u043d\u0435\u0451, \u0430 \u0442\u0430\u043a \u0436\u0435 \u0440\u0443\u0441\u0441\u043a\u0438\u0445 \u0431\u0443\u043a\u0432");case 11:if(_e){e.next=14;break}throw Object(y.e)("\u041e\u0448\u0438\u0431\u043a\u0430!","\u042d\u0442\u0430\u043f \u0432 \u0432\u043e\u0440\u043e\u043d\u043a\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d"),new Error("\u042d\u0442\u0430\u043f \u0432 \u0432\u043e\u0440\u043e\u043d\u043a\u0435 \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d");case 14:return t={name:X,surname:Z,midname:ne,gender:se,dateOfBirth:H.toISOString(),phones:xe.split(",")||void 0,discord:""!==ke?String(ke.match(P).shift()):void 0,parentPhones:je.split(","),parentFullname:Oe,salesFunnelStep:_e},e.next=17,Object(S.a)(n,t);case 17:return o=e.sent,Object(y.f)("\u0423\u0441\u043f\u0435\u0448\u043d\u043e!","\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441\u043e\u0437\u0434\u0430\u043d!"),F(),e.next=22,c((function(e){return[].concat(Object(a.a)(e),[Object(r.a)(Object(r.a)({},o),{},{closestTask:[]})])}));case 22:u((function(e){return!0})),u((function(e){return!1})),U(!1),q(!1),ze(),e.next=35;break;case 29:e.prev=29,e.t0=e.catch(0),s||console.log(e.t0),U(!0),q(!1),e.t0.response&&(Object(w.a)(e.t0.response.status),l=e.t0.response,j=l.status,d=l.data,400===j&&Object(y.e)("\u041d\u0435 \u0432\u0435\u0440\u043d\u043e \u0432\u0432\u0435\u0434\u0435\u043d\u044b \u0434\u0430\u043d\u043d\u044b\u0435"),"TOKEN_EXPIRED"===d.message&&Object(_.a)(d.token),401===j&&(localStorage.removeItem("tokenID"),window.location.replace("/")),500===j&&Object(y.e)("\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"));case 35:case"end":return e.stop()}}),e,null,[[0,29]])})));return function(){return e.apply(this,arguments)}}();return Object(N.jsxs)(N.Fragment,{children:[x?Object(N.jsx)("div",{style:{position:"absolute",right:0},className:"collapse d-flex flex-row-reverse",id:"navbarScroll",children:Object(N.jsx)("div",{className:"d-flex plus-box",children:Object(N.jsx)("div",{className:"nav-item plus",onClick:Re,children:Object(N.jsx)("i",{className:"bi bi-person-plus",style:{fontSize:"38px",color:"#F56767"}})})})}):Object(N.jsx)(k.a,{style:b.l,onClick:Re}),Object(N.jsx)(O.a,{width:900,title:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0443\u0447\u0435\u043d\u0438\u043a\u0430",visible:R,onCancel:Me,footer:[Object(N.jsx)(p.a,{onClick:Me,children:"\u041e\u0442\u043c\u0435\u043d\u0430"},"back"),Object(N.jsx)(p.a,{onClick:Ue,loading:L,type:"primary",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"},"submit")],children:Object(N.jsxs)("form",{action:"#",method:"POST",children:[Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u0418\u043c\u044f:"}),Object(N.jsx)(h.a,{onChange:Object(C.a)(G,"event.target.value"),value:X,required:!0})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f:"}),Object(N.jsx)(h.a,{onChange:Object(C.a)($,"event.target.value"),value:Z,required:!0})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e:"}),Object(N.jsx)(h.a,{onChange:Object(C.a)(ce,"event.target.value"),value:ne,required:!0})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u0412\u043e\u0437\u0440\u0430\u0441\u0442:"}),Object(N.jsx)(f.a,{className:"form-control",placeholder:"\u0413\u0413\u0413\u0413.\u041c\u041c.\u0414\u0414",defaultValue:m()("01-01-2021",D),format:D,onChange:Object(C.a)(K,"event")})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u0424\u0418\u041e \u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044f:"}),Object(N.jsx)(h.a,{onChange:Object(C.a)(pe,"event.target.value"),value:Oe,required:!0,placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u0418\u043c\u044f \u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e"})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u041d\u0438\u043a \u0432 \u0434\u0438\u0441\u043a\u043e\u0440\u0434\u0435:"}),Object(N.jsx)(h.a,{onChange:Object(C.a)(Se,"event.target.value"),value:ke,placeholder:"\u041d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e"})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0440\u0435\u0431\u0451\u043d\u043a\u0430:"}),Object(N.jsx)(g.a,{autoComplete:"off",onChange:Object(C.a)(me,"event.target.value"),onKeyDown:qe(Ee),onFocus:Le,style:b.k,type:"tel",name:"tel",className:"form-control",mask:Ie.join(""),placeholder:"\u041d\u0435\u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435"})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f:"}),Object(N.jsx)(g.a,{autoComplete:"off",onChange:Object(C.a)(ue,"event.target.value"),onKeyDown:qe(Ye),onFocus:Le,style:b.k,type:"tel",name:"tel",className:"form-control",mask:Te.join("")})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u041f\u043e\u043b:"}),Object(N.jsxs)("select",{onChange:Object(C.a)(ie,"event.target.value"),name:"gender",value:se,className:"form-control",required:!0,children:[Object(N.jsx)("option",{defaultValue:!0}),Object(N.jsx)("option",{value:"\u041c\u0443\u0436\u0441\u043a\u043e\u0439",children:"\u041c\u0443\u0436\u0441\u043a\u043e\u0439"}),Object(N.jsx)("option",{value:"\u0416\u0435\u043d\u0441\u043a\u0438\u0439",children:"\u0416\u0435\u043d\u0441\u043a\u0438\u0439"})]})]}),Object(N.jsxs)(b.b,{children:[Object(N.jsx)("p",{children:"\u0412\u043e\u0440\u043e\u043d\u043a\u0430:"}),Object(N.jsxs)("select",{className:"form-control",name:"salesFunnelId",value:_e,onChange:Object(C.a)(Ce,"event.target.value"),children:[E,t.map((function(e){return t[0]._id===e._id?Object(N.jsx)("option",{value:e._id,defaultValue:!0,children:e.name},e._id):Object(N.jsx)("option",{value:e._id,children:e.name},e._id)}))]})]})]})})]})})),I=n(25),E=n(10).a.div(c||(c=Object(I.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: ",";\n  .lds-ring {\n    display: inline-block;\n    position: relative;\n    width: 80px;\n    height: 80px;\n  }\n  .lds-ring div {\n    box-sizing: border-box;\n    display: block;\n    position: absolute;\n    width: 64px;\n    height: 64px;\n    margin: 8px;\n    border: 8px solid #001529;\n    border-radius: 50%;\n    animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n    border-color: #001529 transparent transparent transparent;\n  }\n  .lds-ring div:nth-of-type(1) {\n    animation-delay: -0.45s;\n  }\n  .lds-ring div:nth-of-type(2) {\n    animation-delay: -0.3s;\n  }\n  .lds-ring div:nth-of-type(3) {\n    animation-delay: -0.15s;\n  }\n  @keyframes lds-ring {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n"])),(function(e){return e.precentage?"100%":"100vh"})),P=function(e){var t=e.precentage;return Object(N.jsx)(E,{precentage:t,children:Object(N.jsxs)("div",{className:"lds-ring",children:[Object(N.jsx)("div",{}),Object(N.jsx)("div",{}),Object(N.jsx)("div",{}),Object(N.jsx)("div",{})]})})},D=n(81),T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:24,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return e+n.length>c?Object(N.jsx)(D.a,{placement:"leftTop",title:"".concat(a).concat(""!==a?" ":"").concat(t),children:Object(N.jsxs)(b.h,{width:r,children:[n," ",t]})}):Object(N.jsxs)(b.h,{children:[n," ",t]})},Y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:24,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return e+n.length>c?Object(N.jsx)(D.a,{placement:"leftTop",title:"".concat(a).concat(""!==a?" ":"").concat(t.surname," ").concat(t.name," ").concat(t.midname),children:Object(N.jsxs)(b.h,{width:r,children:[t.surname," ",t.name," ",t.midname]})}):Object(N.jsxs)(b.h,{children:[t.surname," ",t.name," ",t.midname]})},L=n(13),q=n(34),z=n(384),M=n(225),R=function(e){var t,n,c,r=e.closestTask;return Object(N.jsxs)(b.a,{children:[Object(N.jsx)("p",{className:"name",children:null===r||void 0===r?void 0:r.name}),Object(N.jsxs)("p",{children:["\u0414\u043e: ",m()(null===r||void 0===r?void 0:r.deadline).format("DD/MM/YYYY | HH:mm")]}),Object(N.jsxs)("p",{children:["\u041e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u0435\u043d: ",null===r||void 0===r||null===(t=r.responsible[0])||void 0===t?void 0:t.surname," ",null===r||void 0===r||null===(n=r.responsible[0])||void 0===n?void 0:n.name," ",null===r||void 0===r||null===(c=r.responsible[0])||void 0===c?void 0:c.midname]}),Object(N.jsx)("div",{children:null===r||void 0===r?void 0:r.text})]})},U=function(e){e.Url;var t=e.card,n=e.pupils,c=(e.pageSize,n.pupilsList),a=Object(j.useState)(!1),s=Object(l.a)(a,1)[0];return Object(N.jsx)(N.Fragment,{children:s?Object(N.jsx)(P,{precentage:!0}):c.filter((function(e){return e.salesFunnelStep===t._id})).map((function(e,n){return Object(N.jsx)(d.b,{draggableId:"".concat(e._id),index:n,children:function(n){return Object(N.jsx)(b.g,Object(r.a)(Object(r.a)(Object(r.a)({background:t.background},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef,children:Object(N.jsxs)("div",{className:"funnelStepStudent__first--info",children:[Object(N.jsx)("div",{children:Object(N.jsx)(q.c,{to:"/student/".concat(e._id),children:Y("".concat(e.surname," ").concat(e.name," ").concat(e.midname).length,e,"",25,"230px","\u0424\u0418\u041e:")})}),Object(N.jsxs)("div",{children:[Object(N.jsx)(b.m,{children:"\u0422\u0435\u043b.\u0420\u043e\u0434\u0438\u0442\u0435\u043b\u044f:"})," ","78"]}),Object(N.jsxs)("div",{children:[Object(N.jsx)(b.m,{children:"\u041c\u0438\u043d.\u0410\u0431\u043e\u043d\u0435\u043c\u0435\u043d\u0442:"})," ",e.minPaidSubscription||0,"\u20bd"]}),Object(N.jsx)(b.j,{portable:!0,contains:e.statuses.length,children:e.statuses.map((function(e){return Object(N.jsx)(z.a,{color:e.color,children:e.name},e._id)}))}),e.closestTask.length?Object(N.jsx)(M.a,{overlay:Object(N.jsx)(R,{closestTask:e.closestTask[0]}),children:Object(N.jsx)(b.i,{children:"\u0411\u043b\u0438\u0436\u0430\u0439\u0448\u0430\u044f \u0437\u0430\u0434\u0430\u0447\u0430"})}):""]})}))}},e._id)}))})};t.default=function(){var e=L.a,t=Object(j.useState)(!0),n=Object(l.a)(t,2),c=n[0],s=n[1],u=Object(j.useState)([]),O=Object(l.a)(u,2),p=O[0],h=O[1],f=Object(j.useState)([]),x=Object(l.a)(f,2),m=x[0],v=x[1];console.log(m),Object(j.useEffect)((function(){return function(){var t=Object(o.a)(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(S.b)(e);case 2:n=t.sent,h((function(e){return n})),v((function(e){return n.map((function(e){return e.pupils})).flat(2)})),s((function(e){return!1}));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),function(){h((function(e){return[]})),v((function(e){return[]}))}}),[e]);var g=function(){var t=Object(o.a)(i.a.mark((function t(n){var c,r,s,o,j,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.destination){t.next=2;break}return t.abrupt("return",v((function(e){return e})));case 2:if(c=m.filter((function(e){return e.salesFunnelStep===n.source.droppableId})),r=m.filter((function(e){return e.salesFunnelStep===n.destination.droppableId})),s=c.splice(n.source.index,1),o=Object(l.a)(s,1),j=o[0],n.source.droppableId!==n.destination.droppableId){t.next=8;break}return c.splice(n.destination.index,0,j),t.abrupt("return",v((function(e){return Array.from(new Set([].concat(Object(a.a)(e),Object(a.a)(c),Object(a.a)(r))))})));case 8:return u=j.statuses,j.statuses=j.statuses.map((function(e){return e._id})),j.salesFunnelStep=n.destination.droppableId,t.next=13,Object(S.c)(e,j._id,j);case 13:return j.statuses=u,r.splice(n.destination.index,0,j),t.abrupt("return",v((function(e){return Array.from(new Set([].concat(Object(a.a)(e),Object(a.a)(c),Object(a.a)(r))))})));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(N.jsx)(b.n,{children:c?Object(N.jsx)(P,{}):Object(N.jsx)(b.c,{jstctn:p.length<6,children:Object(N.jsx)(d.a,{onDragEnd:g,children:p.map((function(t){return Object(N.jsxs)(b.d,{style:"\u0417\u0430\u043d\u0438\u043c\u0430\u044e\u0442\u0441\u044f"===t.name||"\u0417\u0430\u043d\u0438\u043c\u0430\u0435\u0442\u0441\u044f"===t.name?{display:"none"}:{display:"block"},className:"card",children:[Object(N.jsxs)(b.f,{background:t.background,children:[T(t.name.length,t.name,"",30,"220px"),1===t.order?Object(N.jsx)(F,{setLoaded:s,status:1,funnel:p,Url:e,setPupilsList:v}):""]}),Object(N.jsxs)(b.e,{background:t.background,children:[t.minPaidSubscriptionsAmount||0,"\u0440\u0443\u0431."]}),Object(N.jsx)(d.c,{droppableId:"".concat(t._id),children:function(n){return Object(N.jsxs)("div",Object(r.a)(Object(r.a)({className:"droppable-container"},n.droppableProps),{},{ref:n.innerRef,children:[Object(N.jsx)(U,{card:t,pupils:{pupilsList:m,setPupilsList:v},Url:e}),n.placeholder]}))}})]},t._id)}))})})})}}}]);
//# sourceMappingURL=4.09f23d76.chunk.js.map