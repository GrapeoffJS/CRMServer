(this["webpackJsonpcrm-shool-app"]=this["webpackJsonpcrm-shool-app"]||[]).push([[5],{672:function(e,t,n){"use strict";n.r(t);var r,a,c,i,o,s,u,d,f,l,p,b,j=n(18),O=n.n(j),x=n(9),m=n(35),h=n(4),k=n(0),v=n.n(k),y=n(20),g=n.n(y),T=n(24),w=n(10),C=function(e){return"Expired"===e?"crimson":"Today"===e?"#6290FF":"Tomorrow"===e?"#7C9C51":void 0},S=w.a.div(r||(r=Object(T.a)(["\n  font-family: Tahoma, sans-serief;\n"]))),A=w.a.div(a||(a=Object(T.a)(["\n  display: flex;\n  color: black;\n  > div {\n    width: calc(100% / 3);\n  }\n"]))),B=w.a.div(c||(c=Object(T.a)(["\n  margin: 0 0 8px 0;\n  position: relative;\n  text-align: center;\n  padding: 5px 0;\n  font-size: 20px;\n  font-weight: 600;\n  border-bottom: 4px solid ",';\n  &::before {\n    position: absolute;\n    content: "";\n    display: inline-block;\n    bottom: -19px;\n    right: calc(50% - 8px);\n    border-right: 8px solid transparent;\n    border-left: 8px solid transparent;\n    border-bottom: 8px solid transparent;\n    border-top: 8px solid ',";\n  }\n"])),(function(e){return C(e.type)}),(function(e){return C(e.type)})),F=w.a.div(i||(i=Object(T.a)(["\n  padding: 0 5px 0 5px;\n"]))),R=w.a.div(o||(o=Object(T.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border-radius: 8px;\n  padding: 5px;\n  background: ",";\n  margin: 0 0 10px 0;\n  font-size: 20px;\n  p {margin: 0;}\n"])),(function(e){return(t=e.status)<60?"#DC143C":t<90&&t>=60?"#F6CD52":t>=90?"#7C9C51":void 0;var t})),I=w.a.div(s||(s=Object(T.a)(["\n  display: flex;\n  justify-content: space-between;\n  > div:first-of-type {\n    flex: 0 0 90%;\n  }\n"]))),M=w.a.div(u||(u=Object(T.a)(["\n  display: flex;\n  > .ant-select {\n    flex: 0 1 300px;\n  }\n  > button {\n    margin: 0 10px;\n  }\n"]))),Y=w.a.div(d||(d=Object(T.a)(["\n  background: white;\n  margin: 10px 0;\n  padding: 5px;\n  border-radius: 2px;\n  border: 1px solid ",";\n  border-top: 4px solid ",";\n  > p {\n    margin: 0;\n    word-break: break-word;\n  }\n"])),(function(e){return C(e.type)}),(function(e){return C(e.type)})),_=w.a.div(f||(f=Object(T.a)(["\n  display: flex;\n  align-items: center;\n  font-weight: 600;\n"]))),D=w.a.p(l||(l=Object(T.a)(["\n  opacity: 0.8;\n"]))),E=w.a.p(p||(p=Object(T.a)(["\n  word-break: break-word;\n"]))),z=w.a.span(b||(b=Object(T.a)(["\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 22px;\n  min-height: 22px;\n  max-width: 22px;\n  max-height: 22px;\n  background: transparent;\n  border: 1px solid ",";\n  border-radius: 50%;\n  margin: 0 5px 0 0;\n  > span {\n    display: inline-block;\n    min-width: 16px;\n    min-height: 16px;\n    transition: all .2s ease;\n    background: ",";\n    border-radius: 50%;\n    &:hover {\n      opacity: 0.8;\n    }\n  }\n"])),(function(e){return C(e.type)}),(function(e){return e.active?C(e.type):"transparent"})),H=n(1),L=function(e){var t=e.active,n=e.onClick,r=e.type;return Object(H.jsx)(z,{onClick:n,active:t,type:r,children:Object(H.jsx)("span",{})})},J=n(272),P=n(13),K=n(282),N=n(385),U=n(33),q=n(200),G=n(22),Q=function(e){var t=e.task,n=e.type,r=e.setCompletedTasks,a=e.setTasks,c=e.setReservTasks,i=Object(k.useState)(!1),o=Object(h.a)(i,2),s=o[0],u=o[1],d=function(){var e=Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u((function(e){return!e})),!t.for){e.next=5;break}return e.next=5,Object(q.a)(P.a,t.for,{text:"".concat(t.name,"\n").concat(t.text),color:"crimson"});case 5:return e.next=7,Object(J.a)(P.a,t._id,{done:!0,archived:!0,completedOn:g()().toISOString()});case 7:t.done=!0,r((function(e){return[].concat(Object(x.a)(e),[t]).filter((function(e){return e.done}))})),"Today"!==n&&c((function(e){return[].concat(Object(x.a)(e),[t])})),a((function(e){return e.filter((function(e){return!e.done}))})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),Object(G.e)("\u041e\u0448\u0438\u0431\u043a\u0430!","\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a...");case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();return Object(H.jsxs)(Y,{type:s?"Tomorrow":n,children:[Object(H.jsxs)(_,{children:[Object(H.jsx)(L,{active:s,onClick:d,type:s?"Tomorrow":n}),t.for?Object(H.jsx)(U.c,{to:"/student/".concat((null===t||void 0===t?void 0:t.for)||""),children:t.name}):t.name,Object(H.jsx)(K.j,{portable:!1,contains:t.tags.length,children:t.tags.map((function(e){return Object(H.jsx)(N.a,{color:e.color,children:e.name},e._id)}))})]}),Object(H.jsxs)(D,{children:["\u0414\u043e: ",g()(null===t||void 0===t?void 0:t.deadline).format("DD/MM/YYYY | HH:mm")]}),Object(H.jsx)("p",{children:null===t||void 0===t?void 0:t.text})]})},V=function(e){var t=e.tasks,n=e.type,r=e.children,a=e.setReservTasks,c=e.setCompletedTasks,i=e.setTasks,o=void 0===i?function(){}:i;return Object(H.jsxs)("div",{children:[Object(H.jsx)(B,{type:n,children:r}),Object(H.jsx)(F,{children:t.map((function(e){return Object(H.jsx)(Q,{task:e,type:n,setCompletedTasks:c,setTasks:o,setReservTasks:a},e._id)}))})]})},W=n(116),X=n(368),Z=function(e){var t=e.filterObj,n=W.a.Option,r=t.setFilter,a=Object(k.useState)([]),c=Object(h.a)(a,2),i=c[0],o=c[1];Object(k.useEffect)((function(){(function(){var e=Object(m.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(X.a)(P.a);case 2:t=e.sent,o((function(e){return t}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);return Object(H.jsx)(W.a,{mode:"multiple",onChange:function(e){r((function(t){return e}))},children:i.map((function(e){return Object(H.jsx)(n,{value:e._id,children:e.name},e._id)}))})},$=n(62),ee=n(650),te=n(369),ne=function(e){e.url;var t=e.setAllTasks,n=e.filterTasks,r=Object(k.useState)(!1),a=Object(h.a)(r,2),c=a[0],i=a[1],o=function(){i((function(e){return!1}))};return Object(H.jsxs)(v.a.Fragment,{children:[Object(H.jsx)($.a,{type:"primary",onClick:function(){i((function(e){return!e}))},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u0434\u0430\u0447\u0443"}),Object(H.jsx)(ee.a,{width:800,className:"nonePaddingModal",visible:c,onOk:o,onCancel:o,footer:"",children:Object(H.jsx)(te.a,{setOpenedModal:i,setRelTasks:t,portable:!1,filterTasks:n})})]})},re=n(25),ae=n.n(re),ce=function(){var e=Object(m.a)(O.a.mark((function e(t){var n,r,a=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"",e.next=3,ae.a.get("".concat(t,"/CRM/Tasks/CurrentUserTasks").concat(n),{headers:{authorization:"Bearer ".concat(localStorage.getItem("tokenID"))}});case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(e){var t=e.reservTasks,n=e.completedTasks,r=e.statusTasks;return Object(H.jsxs)(R,{status:r,children:[Object(H.jsx)("div",{}),Object(H.jsxs)("p",{children:[n.length,"/",t.length]})]})},oe=n(646),se=oe.a.TabPane,ue=function(e){var t=e.viewbagFunnel,n=e.viewbagTable;return Object(H.jsxs)(oe.a,{defaultActiveKey:"1",children:[Object(H.jsx)(se,{tab:"\u0412\u043e\u0440\u043e\u043d\u043a\u0430",children:t},"1"),Object(H.jsx)(se,{tab:"\u0422\u0430\u0431\u043b\u0438\u0446\u0430",children:n},"2")]})},de=n(2),fe=n(644),le=n(389),pe=function(e){var t=e.tasks,n=e.setReservTasks,r=e.setCompletedTasks,a=e.setTodayTasks,c=e.setExpiredTasks,i=e.setTomorrowTasks,o=function(){var e=Object(m.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(J.a)(P.a,t._id,{done:!0});case 2:t.done=!0,r((function(e){return e=[].concat(Object(x.a)(e),[t]).filter((function(e){return e.done}))})),g()(t.deadline).isBefore(g()().endOf("day"))&&g()(t.deadline).isAfter(g()().get())||n((function(e){return[].concat(Object(x.a)(e),[t])})),c((function(e){return e.filter((function(e){return!e.done}))})),a((function(e){return e.filter((function(e){return!e.done}))})),i((function(e){return e.filter((function(e){return!e.done}))}));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=t.filter((function(e){return!0!==e.done})).map((function(e){return Object(de.a)(Object(de.a)({},e),{},{complete:e,forLink:{for:e.for,name:e.name},key:e._id,deadline:g()(e.deadline).format("DD/MM/YYYY | HH:mm")})})),u=[{title:"",dataIndex:"complete",key:"complete",render:function(e){return Object(H.jsx)(le.a,{style:{fontSize:"20px",color:"crimson"},onClick:function(){return o(e)}})}},{title:"\u041a\u043e\u043d\u0435\u0447\u043d\u044b\u0439 \u0441\u0440\u043e\u043a",dataIndex:"deadline",key:"deadline"},{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"forLink",key:"forLink",render:function(e){return e.for?Object(H.jsx)(U.c,{to:"/student/".concat((null===e||void 0===e?void 0:e.for)||""),children:e.name}):Object(H.jsx)("span",{children:e.name})}},{title:"\u0422\u0435\u043a\u0441\u0442",dataIndex:"text",key:"text",render:function(e){return Object(H.jsx)(E,{children:e})}},{title:"\u0422\u044d\u0433\u0438",dataIndex:"tags",key:"tags",render:function(e){return Object(H.jsx)(K.j,{portable:!0,contains:e.length,children:e.map((function(e){return Object(H.jsx)(N.a,{color:e.color,children:e.name},e._id)}))})}}];return Object(H.jsx)("div",{children:Object(H.jsx)(fe.a,{columns:u,dataSource:s})})};t.default=function(){var e=Object(k.useState)([]),t=Object(h.a)(e,2),n=t[0],r=t[1],a=Object(k.useState)([]),c=Object(h.a)(a,2),i=c[0],o=c[1],s=Object(k.useState)([]),u=Object(h.a)(s,2),d=u[0],f=u[1],l=Object(k.useState)([]),p=Object(h.a)(l,2),b=p[0],j=p[1],y=Object(k.useState)([]),T=Object(h.a)(y,2),w=T[0],C=T[1],B=Object(k.useState)([]),F=Object(h.a)(B,2),R=F[0],Y=F[1],_=Object(k.useState)([]),D=Object(h.a)(_,2),E=D[0],z=D[1],L=Object(k.useState)(0),J=Object(h.a)(L,2),K=J[0],N=J[1];Object(k.useEffect)((function(){var e=function(e){return e.length?1===e.length?"?tag=".concat(e[0]):"?tag=".concat(e[0]).concat(e.filter((function(t){return t!==e[0]})).map((function(e){return"&tag=".concat(e)})).join("")):""}(n);return function(){var t=Object(m.a)(O.a.mark((function t(){var n,r,a,c,i,s;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ce(P.a,e);case 2:n=t.sent,r=n.filter((function(e){return g()(e.deadline).isBefore(g()().get())})),a=n.filter((function(e){return g()(e.deadline).isBefore(g()().endOf("day"))&&g()(e.deadline).isAfter(g()().get())})),c=n.filter((function(e){return g()(e.deadline).isAfter(g()().endOf("day"))})),i=r.filter((function(e){return e.completedOn})).filter((function(e){return g()(e.completedOn).isBefore(g()().endOf("day"))&&g()(e.completedOn).isAfter(g()().subtract(1,"days"))})),s=c.filter((function(e){return e.completedOn})).filter((function(e){return g()(e.completedOn).isBefore(g()().endOf("day"))&&g()(e.completedOn).isAfter(g()().subtract(1,"days"))})),C((function(e){return[].concat(Object(x.a)(i),Object(x.a)(a.filter((function(e){return e.done}))),Object(x.a)(s))})),Y((function(e){return[].concat(Object(x.a)(i),Object(x.a)(a),Object(x.a)(s))})),f((function(e){return r.filter((function(e){return!e.done}))})),j((function(e){return a.filter((function(e){return!e.done}))})),z((function(e){return c.filter((function(e){return!e.done}))})),o((function(e){return n}));case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),function(){f((function(e){return[]})),j((function(e){return[]})),z((function(e){return[]})),o((function(e){return[]})),C((function(e){return[]}))}}),[n]),Object(k.useEffect)((function(){N((function(e){return R.length?Math.round(w.length/R.length*100):100}))}),[w,R]);var U=Object(H.jsxs)(A,{children:[Object(H.jsx)(V,{tasks:d,type:"Expired",setCompletedTasks:C,setTasks:f,setReservTasks:Y,children:"\u041f\u0440\u043e\u0441\u0440\u043e\u0447\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u0434\u0430\u0447\u0438"}),Object(H.jsx)(V,{tasks:b,type:"Today",setCompletedTasks:C,setTasks:j,children:"\u0417\u0430\u0434\u0430\u0447\u0438 \u043d\u0430 \u0441\u0435\u0433\u043e\u0434\u043d\u044f"}),Object(H.jsx)(V,{tasks:E,type:"Tomorrow",setCompletedTasks:C,setTasks:z,setReservTasks:Y,children:"\u0411\u0443\u0434\u0443\u0449\u0438\u0435 \u0437\u0430\u0434\u0430\u0447\u0438"})]}),q=Object(H.jsx)(v.a.Fragment,{children:Object(H.jsx)(pe,{tasks:i,setReservTasks:Y,setCompletedTasks:C,setTodayTasks:j,setExpiredTasks:f,setTomorrowTasks:z})});return Object(H.jsxs)(S,{children:[Object(H.jsx)(I,{children:Object(H.jsx)(ie,{reservTasks:R,completedTasks:w,statusTasks:K})}),Object(H.jsxs)(M,{children:[Object(H.jsx)(Z,{filterObj:{filter:n,setFilter:r}}),Object(H.jsx)(ne,{url:P.a,filterTasks:function(e){var t=e.filter((function(e){return g()(e.deadline).isBefore(g()().get())})),n=e.filter((function(e){return g()(e.deadline).isBefore(g()().endOf("day"))&&g()(e.deadline).isAfter(g()().get())})),r=e.filter((function(e){return g()(e.deadline).isAfter(g()().endOf("day"))})),a=t.filter((function(e){return e.completedOn})).filter((function(e){return g()(e.completedOn).isBefore(g()().endOf("day"))&&g()(e.completedOn).isAfter(g()().subtract(1,"days"))})),c=r.filter((function(e){return e.completedOn})).filter((function(e){return g()(e.completedOn).isBefore(g()().endOf("day"))&&g()(e.completedOn).isAfter(g()().subtract(1,"days"))}));return Y((function(e){return[].concat(Object(x.a)(a),Object(x.a)(n),Object(x.a)(c))})),f((function(e){return t.filter((function(e){return!e.done}))})),j((function(e){return n.filter((function(e){return!e.done}))})),z((function(e){return r.filter((function(e){return!e.done}))})),e},setAllTasks:o})]}),Object(H.jsx)(ue,{viewbagFunnel:U,viewbagTable:q})]})}}}]);
//# sourceMappingURL=5.f52e2ed9.chunk.js.map