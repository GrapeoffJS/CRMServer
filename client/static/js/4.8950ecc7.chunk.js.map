{"version":3,"sources":["components/home-page/sales-funnel/helpers/loader.jsx","components/home-page/sales-funnel/helpers/tooltip-functions.js","components/home-page/sales-funnel/ClosestTask.jsx","components/home-page/sales-funnel/sales-funnel-students.jsx","components/home-page/sales-funnel/sales-funnel.jsx"],"names":["LoaderTag","styled","div","props","precentage","Loader","className","tooltipNeedsCheckerOfSingleString","length","string","dop","maxLength","width","dopTooltipText","placement","title","tooltipCheckerOfTrioString","stud","midname","name","surname","ClosestTask","closestTask","moment","deadline","format","responsible","text","SalesFunnelStudents","Url","card","pupils","pupilsList","pageSize","useState","loaded","filter","salesFunnelStep","_id","map","index","draggableId","provided","background","draggableProps","dragHandleProps","ref","innerRef","to","parentPhone","minPaidSubscription","contains","statuses","stat","color","overlay","SalesFunnel","UrlProd","setLoaded","salesFunnelList","setSalesFunnelList","setPupilsList","salesFunnelFromServer","useCallback","a","axiosGetFunnelSteps","salesFunnelSteps","prev","step","flat","useEffect","onDragEndHandler","result","destination","array1","source","droppableId","array2","splice","deletingElement","Array","from","Set","oldStatuses","el","axiosUpdateStudent","jstctn","onDragEnd","order","loader","status","funnel","minPaidSubscriptionsAmount","provide","droppableProps","placeholder"],"mappings":"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","file":"static/js/4.8950ecc7.chunk.js","sourcesContent":["import React from \"react\"\nimport styled from \"@emotion/styled\"\n\nconst LoaderTag = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: ${props => props.precentage ? \"100%\" : \"100vh\"};\n  .lds-ring {\n    display: inline-block;\n    position: relative;\n    width: 80px;\n    height: 80px;\n  }\n  .lds-ring div {\n    box-sizing: border-box;\n    display: block;\n    position: absolute;\n    width: 64px;\n    height: 64px;\n    margin: 8px;\n    border: 8px solid #001529;\n    border-radius: 50%;\n    animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n    border-color: #001529 transparent transparent transparent;\n  }\n  .lds-ring div:nth-of-type(1) {\n    animation-delay: -0.45s;\n  }\n  .lds-ring div:nth-of-type(2) {\n    animation-delay: -0.3s;\n  }\n  .lds-ring div:nth-of-type(3) {\n    animation-delay: -0.15s;\n  }\n  @keyframes lds-ring {\n    0% {\n      transform: rotate(0deg);\n    }\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n`\n\nexport const Loader = ({ precentage }) => {\n  return (\n    <LoaderTag precentage={precentage}>\n      <div className=\"lds-ring\">\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n      </div>\n    </LoaderTag>\n  );\n};","// imports from plugins\nimport {Tooltip} from \"antd\"\nimport React from \"react\"\n\n// imports from files of project\nimport {FunnelStepText} from \"./sales-funnel-styled\"\n\nexport const tooltipNeedsCheckerOfSingleString = (length, string, dop = '', maxLength = 24, width = \"\", dopTooltipText = \"\") => {\n  if (length + dop.length > maxLength) {\n    return (\n      <Tooltip placement=\"leftTop\" title={`${dopTooltipText}${dopTooltipText !== \"\" ? \" \" : \"\"}${string}`}>\n        <FunnelStepText width={width}>{dop} {string}</FunnelStepText>\n      </Tooltip>\n    )\n  }\n  return <FunnelStepText>{dop} {string}</FunnelStepText>\n}\n\nexport const tooltipCheckerOfTrioString = (length, stud, dop = '', maxLength = 24, width = \"\", dopTooltipText = \"\") => {\n  if (length + dop.length > maxLength) {\n    return (\n      <Tooltip placement=\"leftTop\" title={`${dopTooltipText}${dopTooltipText !== \"\" ? \" \" : \"\"}${stud.midname} ${stud.name} ${stud.surname}`}>\n        <FunnelStepText width={width}>{stud.midname} {stud.name} {stud.surname}</FunnelStepText>\n      </Tooltip>\n    )\n  }\n  return <FunnelStepText>{stud.midname} {stud.name} {stud.surname}</FunnelStepText>\n}","import moment from \"moment\"\r\nimport React from \"react\"\r\n\r\nimport {DropdownClosestTask} from \"./helpers/sales-funnel-styled\"\r\n\r\nexport const ClosestTask = ({closestTask}) => {\r\n  return (\r\n    <DropdownClosestTask>\r\n      <p className=\"name\">{closestTask.name}</p>\r\n      <p>До: {moment(closestTask.deadline).format(\"DD/MM/YYYY | HH:mm\")}</p>\r\n      <p>Ответственнен: {closestTask.responsible[0].midname} {closestTask.responsible[0].name} {closestTask.responsible[0].surname}</p>\r\n      <div>\r\n        {closestTask.text}\r\n      </div>\r\n    </DropdownClosestTask>\r\n  )\r\n}","// imports from plugins\r\nimport React, {useState} from \"react\"\r\nimport {Draggable} from \"react-beautiful-dnd\"\r\nimport {NavLink} from \"react-router-dom\"\r\nimport {Tag, Button, Dropdown} from \"antd\"\r\nimport moment from \"moment\"\r\n\r\n// imports from files of project\r\nimport {\r\n  DropdownClosestTask,\r\n  FunnelStepStudent,\r\n  HoverTask,\r\n  StatusesBlock,\r\n  VisibilitySpan\r\n} from \"./helpers/sales-funnel-styled\"\r\nimport {Loader} from \"./helpers/loader\"\r\nimport {tooltipCheckerOfTrioString} from \"./helpers/tooltip-functions\"\r\nimport {ClosestTask} from \"./ClosestTask\"\r\n\r\nexport const SalesFunnelStudents = ({Url, card, pupils, pageSize}) => {\r\n\r\n  // data\r\n  const {pupilsList} = pupils\r\n  // data\r\n\r\n  // useState\r\n  const [loaded] = useState(false)\r\n  // useState\r\n\r\n  // methods\r\n  const lengthCalculate = (statuses) => {\r\n    if (Array.isArray(statuses)) return statuses.length\r\n    return 0\r\n  }\r\n  // methods\r\n\r\n  return (\r\n    <>\r\n      {loaded ? <Loader\r\n        precentage={true}/> : pupilsList.filter(stud => stud.salesFunnelStep === card._id).map((stud, index) => {\r\n        if (card._id === stud.salesFunnelStep) return (\r\n          <Draggable key={stud._id} draggableId={`${stud._id}`} index={index}>\r\n            {provided => (\r\n              <FunnelStepStudent background={card.background} {...provided.draggableProps}\r\n                                 {...provided.dragHandleProps} ref={provided.innerRef}>\r\n                <div className=\"funnelStepStudent__first--info\">\r\n                  <div>\r\n                    <NavLink to={`/student/${stud._id}`}>\r\n                      {tooltipCheckerOfTrioString(`${stud.midname} ${stud.name} ${stud.surname}`.length, stud, \"\", 25, \"230px\", \"ФИО:\")}\r\n                    </NavLink>\r\n                  </div>\r\n                  <div>\r\n                    <VisibilitySpan>Тел.Родителя:</VisibilitySpan> {stud.parentPhone}\r\n                  </div>\r\n                  <div>\r\n                    <VisibilitySpan>Мин.Абонемент:</VisibilitySpan> {stud.minPaidSubscription || 0}₽\r\n                  </div>\r\n                  <StatusesBlock contains={stud.statuses.length}>\r\n                    {stud.statuses.map(stat => (\r\n                      <Tag key={stat._id} color={stat.color}>{stat.name}</Tag>\r\n                    ))}\r\n                  </StatusesBlock>\r\n                  {stud.closestTask.length ? <Dropdown overlay={<ClosestTask closestTask={stud.closestTask[0]} />}>\r\n                    <HoverTask>\r\n                      Ближайшая задача\r\n                    </HoverTask>\r\n                  </Dropdown> : \"\"}\r\n                </div>\r\n              </FunnelStepStudent>\r\n            )}\r\n          </Draggable>\r\n        )\r\n      })}\r\n    </>\r\n\r\n  )\r\n}","// imports from plugins\r\nimport React, {useCallback, useEffect, useState} from \"react\"\r\nimport {DragDropContext, Droppable} from \"react-beautiful-dnd\"\r\n\r\n// imports from files of project\r\nimport {\r\n  FunnelSection,\r\n  FunnelStep,\r\n  FunnelStepAbonementSum,\r\n  FunnelStepHeader,\r\n  Wrapper\r\n} from \"./helpers/sales-funnel-styled\"\r\nimport {SalesFunnelModal} from \"./sales-funnel-modal\"\r\nimport {Loader} from \"./helpers/loader\"\r\nimport {tooltipNeedsCheckerOfSingleString} from \"./helpers/tooltip-functions\"\r\nimport UrlProd from \"../../../url/url\"\r\nimport {SalesFunnelStudents} from \"./sales-funnel-students\"\r\nimport {axiosGetFunnelSteps, axiosUpdateStudent} from \"./helpers/axios-requests\"\r\n\r\nconst SalesFunnel = () => {\r\n\r\n  // data\r\n  const status = 1\r\n  const Url = status ? UrlProd : \"https://dvmncrm.herokuapp.com\"\r\n  //const pageSize = 8\r\n  // data\r\n\r\n  // useState\r\n  const [loaded, setLoaded] = useState(true)\r\n  const [salesFunnelList, setSalesFunnelList] = useState([])\r\n  const [pupilsList, setPupilsList] = useState([])\r\n  // useState\r\n\r\n  // useCallback\r\n  const salesFunnelFromServer = useCallback(async () => {\r\n    const salesFunnelSteps = await axiosGetFunnelSteps(Url)\r\n    setSalesFunnelList(prev => prev = salesFunnelSteps)\r\n    setPupilsList(prev => prev = salesFunnelSteps.map(step => step.pupils).flat(2))\r\n    setLoaded(prev => prev = false)\r\n  }, [Url])\r\n  // useCallback\r\n\r\n  // useEffect\r\n  useEffect(() => {\r\n    salesFunnelFromServer()\r\n  }, [Url, salesFunnelFromServer])\r\n  // useEffect\r\n\r\n  // Methods\r\n  const onDragEndHandler = async (result) => {\r\n    if (!result.destination) {\r\n      return setPupilsList(prev => prev)\r\n    }\r\n\r\n    const array1 = pupilsList.filter((stud) => stud.salesFunnelStep === result.source.droppableId)\r\n    const array2 = pupilsList.filter((stud) => stud.salesFunnelStep === result.destination.droppableId)\r\n    const [deletingElement] = array1.splice(result.source.index, 1)\r\n\r\n    if (result.source.droppableId === result.destination.droppableId) {\r\n      array1.splice(result.destination.index, 0, deletingElement)\r\n\r\n      return setPupilsList(prev => Array.from(new Set([...prev, ...array1, ...array2])))\r\n    }\r\n\r\n    const oldStatuses = deletingElement.statuses\r\n    deletingElement.statuses = deletingElement.statuses.map(el => el = el._id)\r\n    deletingElement.salesFunnelStep = result.destination.droppableId\r\n\r\n    await axiosUpdateStudent(Url, deletingElement._id, deletingElement)\r\n    deletingElement.statuses = oldStatuses\r\n\r\n    array2.splice(result.destination.index, 0, deletingElement)\r\n\r\n    return setPupilsList(prev => Array.from(new Set([...prev, ...array1, ...array2])))\r\n  }\r\n  // Methods\r\n\r\n  return (\r\n    <Wrapper>\r\n      {loaded ? <Loader/> : <FunnelSection jstctn={salesFunnelList.length < 6 ? true : false}>\r\n        <DragDropContext onDragEnd={onDragEndHandler}>\r\n          {salesFunnelList.map(card =>\r\n            <FunnelStep key={card._id} className={\"card\"}>\r\n              <FunnelStepHeader background={card.background}>\r\n                {tooltipNeedsCheckerOfSingleString(card.name.length, card.name, \"\", 30, \"220px\")}\r\n                {card.order === 1 ?\r\n                  <SalesFunnelModal loader={{loaded, setLoaded}} status={status}\r\n                                    funnel={salesFunnelList} Url={Url}\r\n                                    pupils={{pupilsList, setPupilsList}}/> : \"\"}\r\n              </FunnelStepHeader>\r\n              <FunnelStepAbonementSum background={card.background}>\r\n                {card.minPaidSubscriptionsAmount || 0}руб.\r\n              </FunnelStepAbonementSum>\r\n              <Droppable droppableId={`${card._id}`}>\r\n                {provide => (\r\n                  <div className=\"droppable-container\" {...provide.droppableProps}\r\n                       ref={provide.innerRef}>\r\n                    <SalesFunnelStudents card={card} pupils={{pupilsList, setPupilsList}} Url={Url}/>\r\n                    {provide.placeholder}\r\n                  </div>\r\n                )}\r\n              </Droppable>\r\n            </FunnelStep>\r\n          )}\r\n        </DragDropContext>\r\n      </FunnelSection>}\r\n    </Wrapper>\r\n  )\r\n}\r\n\r\nexport default SalesFunnel"],"sourceRoot":""}